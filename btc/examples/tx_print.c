#define LOG_TAG "ex"
#include <stdio.h>
#include <inttypes.h>
#include <stdlib.h>
#include <string.h>
#include "btc.h"
#include "btc_crypto.h"
#include "btc_tx.h"
#include "utl_log.h"
#include "utl_dbg.h"
#include "mbedtls/sha256.h"


static bool misc_str2bin(uint8_t *pBin, uint32_t BinLen, const char *pStr)
{
    if (strlen(pStr) != BinLen * 2) {
        fprintf(stderr, "fail: invalid buffer size: %zu != %" PRIu32 " * 2\n", strlen(pStr), BinLen);
        return false;
    }

    bool ret = true;

    char str[3];
    str[2] = '\0';
    uint32_t lp;
    for (lp = 0; lp < BinLen; lp++) {
        str[0] = *(pStr + 2 * lp);
        str[1] = *(pStr + 2 * lp + 1);
        if (!str[0]) {
            //偶数文字で\0ならばOK
            break;
        }
        if (!str[1]) {
            //奇数文字で\0ならばNG
            fprintf(stderr, "fail: odd length\n");
            ret = false;
            break;
        }
        char *endp = NULL;
        uint8_t bin = (uint8_t)strtoul(str, &endp, 16);
        if ((endp != NULL) && (*endp != 0x00)) {
            //変換失敗
            fprintf(stderr, "fail: *endp = %p(%02x)\n", endp, *endp);
            ret = false;
            break;
        }
        pBin[lp] = bin;
    }

    return ret;
}

int main(void)
{
    utl_log_init_stderr();
#if defined(USE_BITCOIN)
    btc_init(BTC_BLOCK_CHAIN_BTCTEST, true);
#elif defined(USE_ELEMENTS)
    btc_init(BTC_BLOCK_CHAIN_LIQREGTEST, true);
#endif

#if 0
    printf("=======================================\n");
    const uint8_t SCRIPT[] = {
        0x76, 0xa9, 0x14, 0xb7, 0x67, 0xec, 0xfc, 0xb1,
        0x90, 0x4f, 0x83, 0x52, 0x04, 0x2c, 0xba, 0xb4,
        0x66, 0x52, 0xb6, 0x72, 0xac, 0x83, 0x8b, 0x87,
        0x63, 0xac, 0x67, 0x21, 0x03, 0x3a, 0x16, 0xd2,
        0x7d, 0xc4, 0x6a, 0x52, 0xe6, 0x12, 0x47, 0xe8,
        0x9a, 0x3e, 0xf0, 0xe5, 0xde, 0xcc, 0xcb, 0x88,
        0xa8, 0x31, 0x0a, 0x81, 0xc2, 0xe5, 0xc2, 0x42,
        0xfb, 0x36, 0x57, 0x9f, 0xb6, 0x7c, 0x82, 0x01,
        0x20, 0x87, 0x64, 0x75, 0x52, 0x7c, 0x21, 0x02,
        0x9e, 0x3b, 0xd7, 0x3e, 0xd3, 0xa3, 0x84, 0x22,
        0x2a, 0x8d, 0x15, 0x3f, 0x9c, 0x01, 0x3b, 0x93,
        0x1f, 0x9a, 0xce, 0x2a, 0xcf, 0xb5, 0x7a, 0x87,
        0x5a, 0xff, 0x2d, 0x74, 0x3d, 0x55, 0x4e, 0x7b,
        0x52, 0xae, 0x67, 0xa9, 0x14, 0x87, 0x02, 0xae,
        0x98, 0xc0, 0x4f, 0x3e, 0xd2, 0x4b, 0xdd, 0x95,
        0xd5, 0xe3, 0x63, 0x2e, 0x16, 0x8c, 0xdd, 0x14,
        0x68, 0x88, 0xac, 0x68, 0x68,
    };
    ptarm_print_script(SCRIPT, sizeof(SCRIPT));
#endif

#if 1
    printf("=======================================\n");
#if defined(USE_BITCOIN)
    //testnet: 364451d26ede19bf9af66766c73dad221410a52bb7ab2601cd26ac91f23a1c9a
    //  weight=669byte
    //  vsize=168byte
    const char TXSTR[] = "020000000001014859f84e131cb30c0258b685867abc9fd813841d4415307a81cdff515f0b16630100000017160014ad3bac99120815f8dfd72f8eb3129a69c97da900feffffff02a4942d040000000017a9140ab15aebc79f1610a181ce0fc165c351dd955e248740420f00000000001976a9143e8720f6486b4e6681e802a955be61b46fbb6e5788ac02473044022012f9ff774b07ddd87a71fc6a85a8dbcab86edd55ac34320f952c06f883c8847d02201953be46b8d89302b0cdfb797e72e9befd6dcb02796569505e75f45a7fd320f6012103e64c663159fe5bbf699a5979bef59fa1fed13303e8c7f6baaeefdaf3e93b551f5da51400";
#elif defined(USE_ELEMENTS)
    //elementsregtest: 5d25915f3ddc914832c1c85e213ee87d7e316d5c69cacc895f644cd257d7568d
    //  weight=1128byte
    //  vsize=282byte
    const char TXSTR[] = "020000000101200414c08a781527c56c8ce492a011d8e13f4d1969191b35e8321e6e9fce7be20000000017160014d187d71e28111ed4da49784fed999578fcd56c49fdffffff0301230f4f5d4b7c6fa845806ee4f67713459e1b69e8e60fcee2e4940c7a0d5de1b2010003baf8270dbf000017a91454dd3bfc29ca216f6144cef1c24d89bf6fb2a6e98701230f4f5d4b7c6fa845806ee4f67713459e1b69e8e60fcee2e4940c7a0d5de1b2010000000005f569000017a91400c7dd68a8cc06ecd92a838c58f8a9ed2a6669af8701230f4f5d4b7c6fa845806ee4f67713459e1b69e8e60fcee2e4940c7a0d5de1b201000000000000160800002e01000000000247304402204cb4b94a4a009f74b676637f7ec385fd2340378da91324e81f9dd363c679dabe02203d78d14089010c5cd1b1dad82ec4b058af0cfeaec928c06a4efd37fb391676dd0121032f7789f47f68b30abea8d1b59b5801d89951482d55f800996ca9bfe6bf74262f00000000000000";

    //txid: 34408b02ea0e5bffa335e8e7983829d7dcf0529ed60b366463dada05568dae52
    //  まだconfidentail transactionのパラメータには対応していないため、TXIDは一致しない
    //confidential transaction(issuance)
    // "size": 11768,
    // "vsize": 3405,
    // "weight": 13619,
    //const char TXSTR[] = "02000000010190f0b93c41a6d069e028c772cdee6ce71871c861e515e57ac9ae4639704f5267000000801716001402d4ff34b5138b0041dda8389a0b3638cd8c829dfdffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000011f6def1900010000009e1197e500050bec7ade32047f24585671746b71b8d6b8885defb85e66ea9bc31149fc960d0c27091581c0f1c29f60ee709e482c1eee84af64dd514f741d840043b1198cb3fd895303368ccf7133ff175ad04c97a7c7ea55c48c31425a699cee50e9eec179270e2bfd17a9141551bc868ca0c4bfbccd574c2638f734109e02cb870a6269d6727da05da542c097f9c587ee4cdfb74578683932c1b174415a9ad212510977e6f895411c2bf53bd116699a591646bc02f7b04240e46cab3638a0a54c1e95031f514989876ce20371de25ca23a7f1c2f75b7229aa1e56c95e8738430c725d9617a914489b69ebf9282e4e118b87c9288f6ef89c290536870b80601a20ba9815101da6822d31660f011c48dfbbf85118a423ba24208fbd600308cacfc3374d0adfdc5c320a51f93fd8ac842a4b5f812bbe87786c01ddbf001d6603f1181cb4693718a09f73a6ada9717cd0bc066dd9544d06d8c0802c3289f1e08717a9142c44cd86af19ccb8ea19f574c361b146d78eea1187015720e990e2d5d4125497f8fd7d59fc26731054c7dd008985b0965191c3be2ae901000000000000000000036a0100015720e990e2d5d4125497f8fd7d59fc26731054c7dd008985b0965191c3be2ae9010000000000006a7c00000000000000000247304402201b3ebd5daf391f98b80a0c86370b8796539575e3ed15142f76175c98d0af1b2102204d70d54312234622566958ff1baca4a63075a39ecefd143193ce7e950bba0e49012103f5e65b93c6ab4c2fe625555f95872eccc4a16ae968235152469e1356dc802e7d00830300078cae215cce271ad1a90820e4680b52037f9aa29d15225a19d52dbaadfdb66923b4ea43b025fdc3b16acea801fcc85d720d5f1857bc0540074b83b840cf66f5bd55e0cd7ea84d1092044a1faf1b729dd48939010027817fce8b3cc7c45e021176a4c62ae16a07dde636b515540f1423ff12f4d27c4826df5c1acfe44421544961fded0c60280000000000000001f472017a22e332a76b4acece96519a587c48a114481c7440d1e7b81037481db4e2792939d28a52b35e6f807fdb333a0e90030827d310e13c022d97e01ef48466bcb7cb6d9d5dfc6d2d1d07d1511e1ce13eaedb020f737d51f7ca99c9770bdc9efb34c3667e3c1f721209516af3b17a4795dcd77802aa65e7e423085d505b89442fadf48ed67d905180cceae360402326a5828cf5a856b6491edccfef0a313f3e3dfbb403ec08fa8eac5b242dec2c225f6455280c59b94fa7da0a29baaf3e5803ba1229fef89527c90a144cafad9d8977cd0a982c26ec391b11f7af0d83a9a1b13047ab69a12c7b66d35f5b3831644d139cf681a73adc299bf439940807afb44b9a7f52e8d45160fc16f3e7ff7b6285572dd767a5ac3436e5c1eacaff02df81c3e880d8604f819cb870422da9d0c20b2146af322eb0c50a2a1fb51cd237b7b029b2489f57c34f4688197326374860e5f2397e59de76c171e752244e8bf7d0c92865aa55a2e4d73108b2584450a795c7588a85c895ac8737de2299a75bd4214c17176641e2c6edba2e71940dea8c8f8faf4c10cb003a00ffdd8d931aaf37b6fc7414c37112f937f9e3568aaeeb2173294a6351d5d5b25b8ba9568ea45056d231c86447d221a67b11c90fe406fbf3c6005909f49c7d57997422be653b8681afc9aa8c28a17f9993c5701038393106d2e1de4c7c5b4c43cf57d6f1c836e847cf9ac616186433623b7d287e6e82db86ec1fb59c0ce8ca169f113856a698c916cb19b6a708f7772aaac85da50e942a7c41c67a9bdb774ba8bfc8445df093f881458b04ab30c276ef4257e8b72f2a8ad47848e41732c66182ed0a95a7c13e7f24561472660d5aff1eea8a88f1ac89e526dd9d8c31f41818d78d9e4cc260645a307897a58e5ab880e15e0e35eb6d27c66fee4e54af62bd34016709a06bd986f80a58db31439955cedf304b3ff918b897dccd4fda0a3aa472019220f4bf99ef7553471eb288ecbcdff117b5b7989c3b62797178352fda8526dc0f50efd625ca97d5b39f747a5ad14b53872b75a0f1f418e4d214c5b939a6f53259a3a752a1cc0d49b9265362acb9b5b4870f23c6346d839c342dd0e59b3717a589d861cbf9d9c06689f8ba822e91879d8f373303ade4733b88a7df0bf7649ac0bed6b764a64bdcf6c92335c7cfcf35f03a39dc6cba76fa50817f91d25363c5a35a8e65ec556bcdc274ebbaa3a36288231c0351d7844424a2a3f06892af694bea5fefa6f050b5de5ddb2a400a1190ecd5dd49bdd175da23710c2e346dfc7b51f14ea29676a684181760dab4147bdb6a45da1c33f06d94f9bafeb857cd94a9c9672b7119ab45a6a6401439f1c9bf26535049910a7676c1d3b94348dee97819caefbe2df94bc8da4f0c04f8d6656b9ad37265db3aa635220baf7769986084105b201570e6e061eb6d84c8edd57dcab2db123b812acce52db7fe703f08ee27974d60e4c0ba228732d2c3562711410d2ee1707ee2c9a100928e29cdd8a3b037c239c50b679b3ff9a81c7e12ad67111e73ad2105587fc139c087090cd68905504b365de66ab516c4b354f0ea7d54499447190a8ddf5efd71ab9fc7b1be5f6f23e2a1030fb77d014a640f9db02c25975a52a4cc4f166928463690c91f2e717ffe8ea42e402cc58fb0c7240d9a2bd10b61f4e1c112532a81381ddb5235e4dc53fac2a0d215df4a6970768e9f4386cae9305140add82315c0c82282362c99e5ee5839bcdebd467b7a1ec28f66ec97fa7d06d2f26a15b1841e7f57ddda23db75a535b29edcead81702484ab713bc3ea24d1947877ead003955bb873fcd15834429c19a48fb77147fe4446396094b0479cd38c7e3dc949acdf08a2c5b1aa2fbf55c3989463703bee056f2af71711896b07f6f9f4f228547931a558e34cc557e0c643d2aa394c9931a16779bbe8264ecf80291b878729788dd7ab6196ecaa88c2e5a1ff0c73fc614a7542befd014b7e04105a6a2005b1c077f5989bb3d7429f860cb04b279398276c6cccf45dc347d274dda8dd2b7ab0f87a4a19eff2f792961318555818fdc3ca1c42edc017ce423e56692c9bcba5c1df12b3d9a4d669b2711feffadd23d54d1d0dd8073a19c24714231063cb4158535dd2b3adb999c556a84c39860c9871a938ed7f346f7a9007d0d4bec41e070986a3d2200edbb68889aeb1dbe7dea817d8a5efa7098bf027bcf499c8af64eb30577e9ae3dee10053106a8cdef0c681586f84cd30cb70630c0b6bfe2c9081eeb77550b7c21774d2dbe3842ff4351f672ae7a3e3fc6c45800266d294984113eb2711ce15fe36ab4858925b57ebc74673665cc59b0e0d1840e9c49e1f585c354c05e6edc3130a1a57c8b57ab2a8bd0624cc6eae77765cf9b201af1d1a3d745c14215883806cc8e9bbbca53e1559ce0494eb6c62e1c41c53ddac143686ee5fad5d493ead3cd616cb9da3edb30f74a4e806def375dfec5cf056ebbedaae9cf9ba8d5e262e6d0ef98a3a28f9e07a5d1007ec0c9b1a24b798a82fb49fcf8bdc922be3c44f6aaefa3d40e3c67300622b4ee7576735293124ae015909bb435c04bc4b792701054598386b92c974affb5387aabf6a654940bbd70ee91e2ba7a32af10d36f77f82ef1ec67493799f054d2037b72db0d969077ddcd7ef6d8768899b79a02e75a75f2d2aa38aaa511b1cec277488c6ca831635e5d27ded2346fccd4b4f122849bab5fd30a275e33fddca9ebaa758971e777d3c05e8f5a07f52857647658dbd07a3a90f30202bf3c7c4ff44e651105aa98e3208f6abea01b928a30c078fb4824fdc6118c06667825a9d5c314d071965a0c498dd2cfac1ce64ddd7812b4351600313febaab0f46e889b4c53610ac7cec4c1019ff0e4ae8b578e19a3a420fe43e5cd154ab6a2ecd67367ebee06d090fc36e7a67d22d8c7d6a8915e0617c2bdd009e9be4a99fad58aade8051a39f01f7bc0d26dc6ead81f852e0b97a6d42623515c94c2510058104b0b7bb92b23adc4c8dd5200cab12cbcd32a14a121f1f0bf068ce4838689fd700aed5686b8dc7b3f4888a55b0b0f8e366cfde4ae4e8fd31ce2385c9b71511a288477aab140fa53c3039a73e314b25dac8b8e3588c4bb4abf0f22b917a47e8704eeca3ad6f0f636aa46e7e8cca7a7b5c6f6a6214584dfec015a65666ff4de2eeca9ad2d7170f0c9d8833bd4968719b63b144b8b252a25bfe6222eaee53a15655de7cc8c5ce2c502d6e36ecfa5107f8b3c94be0e55614a933211f59245d82515b515d1e2a9b2b42ab403b361555eb5f6809e51796e17ff33c00057a85529e8817521ba550b52aa1e43b041740ff0c725f1bbba3a25fbeaa7cce264f47a19844651379c6c9b20df11d92676fa4780391b380387324bebe767576dad2ac166b390f59c884759dc626da9cdc496e41e4086343201882f2b45e3fb29ea6457c25f65c333da7d302fba9dc182b1304a32fec042cfd516848346a8b97fecb5ef9054054cdfb51c2cd712abaafaa6ad5183d3c59fe1bc1a2c52cfc65918353fefdd81ad1691792824994ea0d58e915938955c591e380f683d28b24257428c3988b0cff9b684c3aa1fc48718aaeb65611a03a803478cabd8dd11799ac70f00c799828efe8aa0dd6309778869b3f2d7ad8a37e0142b0293673a87f71b01d06745ea45c46be256fcb02e1c7384ec6100a0d31f9bb7b84f327c2622bc8b538f12dd8a96730355cdba82e243d770de8b82528a85854a978ab097c6caf1438a7bb652994a49e2334cd7e7424e38ffe74221737a5d8ad5fb9f46a524bc8f6a5eb4b482d4ca90b849cceefa5848a6c2e330a9e1f3c13aab5b91c82985786ac1225ff7f87be19a60d3a43c672d1603b87e2fea9aced6b8cfd9821c088d5d4f124cb308f5d2f5ea86839a3b9b54f04f5b01bef56b3a2c26705ad34110a3055bb68b0ba9acd3e6ff0677c911ac5ff43dba70b791ae298fa282ee2d999293217e7be74408ad51bd185bd93b8bcfccd016cb19d13a79d66d9135da62d505aaeca241728f7c726818bf153d1746b8fa7199e709f3f68674428a71981737a70177a204dc65e387edf4122a1795eba8d303dcc53ca358412ae0e7c5026e64091617c092f2d8ecd0e6a350e5425720eb075581f8a213fd5151f24889e522d9e947d072ada205ac80c04089618f09e021bfd8f3f408148401e55640e157efd8c74e6cabd0641021ed6f0233660d4ca26a935fa5f7cab4be08a79f4c6db575b5e23cba5c9c3239bd5d6a4fd32433fa03ad0e7b7c8f2952d960b262d5c38f9aad4e7d9a8cb8691a94259bac805913c4a742b744ec562db32de6820dd5f9e53ebc72787be4e07a0d5edd11fb173c01844815bbf1fed2e5ba5c04ceeefcaaeb5f14e2c273ccb8ee3fa744a6ebc6a33470ac4004ca5b5930f565facdf9f5d1a456742e2fe625ce7148d14c6c54e91e3a3a37ded9f68114f9bac927c212b3ad119e2edc36a45d88f61e397db7548647275b0558a5543793ecc0b73a82b02f9676d2ae6efbaf7fe2886964267b2fb2fe66287dc38ad0535913f9fd8dd5dc16642e3b4d7ccd89786365d949cabfdafa5099c27d6aaf8b73330a711901b608517ae558f16d164d773f4d9da7f44d45c5b04e8aa116369506d3705b2c8238a16e7abd464a9cd7a5ccfe7e77830300074e8bb75f9da5d0782217aa5278dad8694b7a1b8b12e1c312a78f60812a91fa9c3d67b59b531938afd0ad7c61acb673c7db30678516262e34f82346ceafe51a3cc5ae7eaf1b0aa7b3da6af44c9503002fa30e8409eb6ab1f9a558f6d7d672c89e183716a83135d33349a3e12c7e7d1be05418f0dd3bab7193df5143759cbd10f4fd8d0c602700000000000000011803066b3c25478500deaa39e8f32a5ca0066d832e0a083aa976819fe6f100bf573ace703de838f9195a50b3391955312a0689e30575cbf66f3cf46d979928d99d657d9cc0797ab7708e98f0692188ed9dc8869fa0b7b1a64dda5a1a33b43e493078dfc1fd517cf77c03fb66541b349ce78216d735da8dfee0cc8fd586c2d476647cc6e22b8475caa844a18cb247b3ccc7a8a3e1b2c55cc650350bae190cd97f9827e8d6fb545798e1fd7bf8f55e78039676fdb840bd9ac2f1e65e2ad8fa8874308732a5be1e350e65170046322df0f5a6b7813aba275e77ec5e53b95de632d2e24b8e7dc78a87cd117a221fb67f76ffe5b62adeb175617b18982b0e2e35e101006cb3ff7ca075027a1a040f1766b2e4106716a1165a95563abb46a2cb27ae91a748742ef52cd13c813990767f6aa262bb37f7628fd4b5f0f2a6a5efcd08b23162582fe3fb36f9f671b67159091ed5f0e8b7347e28ecf930abd056af4d115e8948460cab338c59e840e4391fd69966283e342a52470653535c40275d7e6ef209d0ffc005b63bb75186ec688985f0189c7cdacdc504c31a0c4c7bb4160c0a705dab01afcf360e725ce7271a2062fba1f7c56d4fd1ff99516558dbd2909aeca2ebe0ea1476e11a4a03b0e22c6ed6c5672f19795f3f1c79545419161c3713db79b6e7a9a0ebbabb1a096d3adbab514934bf4d6fbf3d8a00ccb9bbffee889838324d343be4c6fb55c8af6d052810b4eb88604d4b0b9957931cdfbdb1268f1879ca9a319764fc9bba5274b9baabfbff43e2707345cbdf473d98a9bb64bb3bdd6f09d8fd054ec2b4629332ade26f3bc5dda09f56867649475506ab2be26f06116fe63ece5dae9bb37f9475ad399c9f550513f9cb7c6ac659aec4aeb9b795dcdaa934d8bc2620e97daf15004d98dbeb25848e89daed70302af08053edd7470afb7730faa07f5cd9e0bdc65ad4aed64d53902f7c39d2a8c9640570d2857496090bc6ef08bdb36b54b099421ebf8ddf25bd11cd4ba66c2b09c28d89a479963bc63e648372721c83b6eaa14049032e1559b04309278885be893de694183dac0e016a3b8f1cbfc9c41d47fbe2675dce26dd6289cd14e06ebe4c02ca9644f9289bcadc9a99ffb230a5a4728b02eb3cb8a6d351e1b5802ae9e27c5a3860126266b08ad55c03f70b3fb1c2cf375af11eeafbe339e3b868a0ac79675334f76561f94512f2ebaaf30abe365a233194a6e2d99ccd6fc2105d2e7c7166ca9a69e74141347ed4f8685ee97b055cac296493e1676d3cb4ebdee4504a5cacb9a5a55a0d8128f595d6ae3791ad36010d5e86eb7413c6c570c349897e2ee2ca91bd2f08879f92e979a8bb2aff31e588c01b860f393e5b6b46c51183568fb536b1da0c31557e6b895997e7ea090a90f7fd104520a24380d5b7115227dd05ea0d8c0def34065f1e3d72a0df098e7d128f05380b6b5df9f0eeee6935a08bd3b490411f4d8795468ec08b04c77404bb2459fb3f14cf935c292fbf42bf65e445fa30bb2ee07430ea115b95ee09793373b9a70f54a672fe989bbdff7c337c1b2d3559bd26251fcc12be4b342e66a78f5a9fe801487b951b6dc210472bef629a965a022165558f93f646afa8ce6c7f4fab9296b87535d4890c71be33170dd22e0306eab0c5baf396cb02acbfcd16cd11606b42802a46562803e284d8e0c1fd93fbef9bbbb1a38985d899185add98eddd8a1455343b091a6aaf877388f5d721313bdd64e6478c8372823073cf0c8ba83b6fff102047a427e5b4851c319ce466ed3bb64f9dd241d7ac97d457e9d5e64b71ae433778a115e88b11dbffbe813ccffc6fba655dbf3bf2c868e2e7a6520548f99023070aefd1b70d5140ddf57eca478acf94e30c26db36070434579fc2b2999e6b5e0ffe1bd09011d9b4e3e314c6fb6049e490163f19e8c35b49b45420551c23948e157c5d2af463fa8e96f7e07092ee1a9514ccbe03ffc51fa4f1daf559d0cc39e3c2a5cc75e04fd26f7075fc15580515f23dc527de25748f2b5bee4d6c4020bdc4b258f3b08238662eaaf421a38ac7aef2ae0b7cc129c16021608c1c9605ee1c6efc099370dd7b82592c060be7c0d15d962b39287d0ddc1c9839cc068bf9d2c98a6de13a4ec390173933bcfe8d1390aeb0791b048c5b5a69a9c75a696391b2d9c77a4a97e95a5e92882ee6ee0dc715a608fa2dea26c05a5dd90e74504eb2f79f98fd8f8584447a20ebba1c23f924908042e34a27aa8e8aa2c5fac1bcc542f35cc374c9565314d705ef09a92181f9150c32d2e2d44ff6d325e18c1f382f0838be8281cb2597302e1f538479e23128af9483f9fecbfd1764351e4f9fc905578911fad3a59fd8f7ac80b48510c79031bc9a99e95372ac7273aa61ff8e889b7ba85d1d2d919929df9b7d4e91ee90272aa3b06f98931d0f0d1087d5cb473d8d9ee65ff34d98757e8e84ee01ed6200bb6dbddab3829c1c7cb28ff6738fe043e6bbc3cb0a040d4bd5fe347243e0e8e4c109446cb6c8e13ca3438e9cb69f23630f6dcff8200e962722510946d687c7b748a9f6227291fd41640047995c954de277be6d43ea2767e8f9dee0494c85113e7c378e96481fa8c7c29a51d4d38e2ac8a914ef28fc4967df54e865f78d3e821adf304358be9e2996c4757ba197e49a1e61984e7d34ee7d61015cf7ed5227b406cb4f4b358d2322718f7d171455a114785a532ef3d0402ca01391dd0e2c3d38413c794fe405a501735e7c88c39894d11e10ed5fc69775c2c392f138fa1875f1f2b214d6220ed2e7ebe4ad9849797f7aaa7e1de379de43fc0497303881653f6f7e99fe721bfea3fc5fb2a65f648594465376c619c24e7f2b25d8597eb926d1046f113c9d295eee02093874b0a24e8176649a40123d59b0bbe89734bb36c926303c7bda6b81f857b1963390501396da6461aab9d1a8ea2a2c24708b99c19a27b6935a49f9b542c0dc2a9eb34a27367bd8dc41c55eb8a6289d2fecf2c32a0906d1d7186f21d971bb34652ceb9f5770e838d4228ef15642547c2c30480aa917a6193fbb9af6695fcef4c11ca7b48a0628a32e1ecbba544039c4cff5162bfed0334948d9575cf324495b4ccedd79b0d79330d02d8b252d6ab7ca988e336e3e8ebcf7d99871f932c988e90f1b6d39d1037241bc6c8da13c31be589d23bdb9230b78ee161029e05cc0d3b54fc7c026a81ed67bf18e458ed5b29757ec826974ff350b15d5ae14ee231e840e005eaa7b7fb013fce9a8d0ee5b9530cbccb7375c3046952a9f9121cd2e33b239137725d55549b9b8848f09b18bb77298451c40d7307ac309e090cb6e2c043f69ef42476138d3ffe214e6b6e85c10f88ba4de13ac79a695088f0c7542dd619bbedee9ff2bfe18baf7eb13b5b8a038784d5ee33b26317d7cc12e9aaad0b460d2e627fed4abc430a6fcc997cf998153a995c6cfebc3a115c8e24e2f31dfba470062cfe2010c217d884c9660451810901b3858b9c8d110d6baaf13723d1bb67603762b99a345ed77b6e55d5ad7014ccae6af73c20615759413ca5efe7ee56b404036cc203ea165ee404e7ee5b612990b5dc45465f32dff87de0c9b35e3a5e679513ebbc399d6cf8b7a2169f4afaecf0a3c5a7a412447efb83c64397ac651a5c68a6942d95d9a9609449550d6857111e8f3dde89263f0809f8b9e66886bb6727cf4ea6c5d993f98c682ee6ec70b1fde4b24c6f360d217e371de6d7098bd8b8bda4e873d8f74cd6498d2cfba0cc23ad03b0866c9b7cc04b3cb434ee3db62bcd62993b72182e9097565be0ea52a8714fee98a3b433031b468dde23ced7a49cdfc9f8109dc2e4beada6fae1b1288cfb066234e60415a50c2544b21cc2e2d1d7a29cf6972b7bdc37fe966ed75b02e802b3a79fe4b5692d29ce4093cbd5a1df925fbda2786d2c4d34db6959a0347945f79c37806337c3da3ff08eb90ab257bae526d8760fda02de457b726e5511b78d885e0eeb2fa2fdcee814135a4bd3b7f349410b63ae5743e5717451ff7aac0fc5e10d97b96d529102627222d5a9368337d6fc3eb661141ac10af30ff2092dfe50b346ae51b38851921c0865e7dd1bec0e07bcb450ff39ea3f296685ebb765b1611ed6a9bb7767c14149acb9341900d5f90b996d6977676e5d8d2b163f9c19b07983d9b747cb04e836f74189680a5ec11ed45b4de85b5563f4512962d632050f1e5e69464b4a175e900e837eb18645f6bda91e6b232f35a8fe815f51bed1fe82f6232afa33667cd97f53884ee6fb20343c9ce553014a6a9b6281b0b74a29edb5903172420bb097a51fa13af63b75cecbf8787545f26dc2a014a10bbd21869b35bdb19d3fd95761fa92af34fbb9cb76e333a46fb1c856cbafe9fb378a92d70765b0261b0a61e7b3f768a5217e99c5be1e6c45067c9af425451f568bcbc371a1a45d3ee7380e9f73bc5a44f95dbe2bff814881d32223fa1b7e94994f0c6367deffa165656a3d03ce2f694ff090926068f5c66806d60a2e9aa8c6948bf01ad59108898c39f3083030007b1311e0c6875b1f73c1862d90bafa84ac55e6d35594ab66fa972afdc3e07bb9b0949caa72753c26f0cc5b88b2e11cdd1061df737b7c644b110b7162df3f5851970c4b4190f5a8e4cee3baaec60321696f1392cf70b630f930763a4b648029ad60d9e3b9b95ddeb0be714a1b921657c766638f527335703f3a6499f17f14908edfd0e1060320000000000000001c1948e017cab89de8d32296e5115bc7a33137c626fd4f9f5bdb07c5d950f56ac871d4233900d13d9374f55f5fac22611ab0577e8ce6bce615c8c12c6c1f7565def4421310e784df28d1fb1314200bce5c2d010a3f55909929c700dfaa2af1f4d2a1b038d33eaea9d18188c50bcb538811c93c66552852683d6cca2f0cd884b5f9d12199c09ce59e2c05a8ab3bd309535e5a6d0b2ead1ab7f944ed1ffb840ecf77e2b65e88675bacc8033b3c9597f14876d19bf4843b2bfa750eb60cb4f104ee0a805cf308bac152d97f405d889ef62cbef979eb699cef889948b71d3108949adb9de9321c58099e39911659d4614d9b5716f5278122d1adb772abda0075b1943e856dbad1ab71e88b6f8c36ee81c1cc25e3a1c85342886ffa05a40e8a6989038dcaa36ee357e1ca3a0ddf5482b8060e8c6197437fad77d3cb935e12f132065a750fd93c5a24fabdb4c0eda4b7b36d275e9bfb23c26927c8290b05c4aa318af7a9580c79f1ca92976f3f4100a7cf6e51622af153b29ba360185f61b12a0c5f85f459d2401ae4e3d1704cad1d10f41d302c2b4f768ee06e60325ec0bfca3cb204ecfe8f7af231406a794937f7415b6e6beaca06f54eb325d576e99f221e6998ab0e0413d04b678dd7a7c5bd6c0837507fdfa9f0224da12f15b5a8be7637e1327a8481e5c059486e70af3c2132a135d122c293af59e79aef0929f45ad3eba93a9f16e7b1abf25a606ca04c54ccd79d51fb79131aa957d63d92d53dfcd40f7806417dbdcd070e688d8f91deeb157e5eae77c009caa58b6ebbcc92d6900c1214173da6d821c16f67a360d060a24388733542e44714647fedd72229718c61b994d66e12374cdb5a1bb88ac079c1c90df20e17513dafcb41eb434fb7723ac8aa3624b6a9c2a7b6bcf54d01fb18cdeb8bfc394c041c57571d71f6127f968cfe818a405711193f2b2dbabf947b475eac690cda21751924be7f4903691a01e6ce01f8a90d5c776768e5b4ffdaf67e3d0e9612306a653d1e314fb8b40946e9064e16059795a52dac65b09efeb664b1f33ebdd4719628eecb1b1d7982a034a4c3fad3a4f0849bbae60013e3ddd1264ad0f8d4c107cd6dfdbaa152dac7c58ac1fff9f87550e17f8420232352743c2deea42bbecdc528d85842f78f4910e2d0eba2e83581eec4fe4428de62e15b05d982276b68ed010ec50e4d01ff03cded280af4916380d03d4762ae10f381bd035de67035f71158ba0caa6fc6157ee702d2cbb8af56b067ac3f2b32c64ffe02f39e57d0c4e823a5c36e8e8dfb869cecc6f7b80e8fd42a18f4e0446ede3dff336a4307db1cc7fafb542ab3db1a6beb7dd1924c921381e2125e793fd391c98f9b786b3bb250b4974ecbb15986803a451b0a730fc90430ee2f3384e8a93bacc3aec9372ed54924342cafef926424f11465b13450787367ac578a1abdad00dd180740af544711ad63becb3d78804dd3e9ecf383b7fb9aca40e584fb887362856d9292d8fb0ef63cd3a6af60c5d72406d1e52b572704cce611299f42beb18f7cec58308718b2cd0f6875158583ae7c6a8df9be193819627a223a14d7aeee903c96dfb2c1335a298116ef96a57f9eb94e848e47c2efbfb97e8e73781ea4646164435ecdc641ec58a22e93d46f7ed90a860adb5497413ebc6607e4ed492d5f9210af392463c88ae9b38037bcc68c503ec7525854f81d09c596f035862e3355b333164d50fce5a0be53dc600a3dd11689251997b9736fcf74f6470364eaf4a9367e18bbaa097acd79db3b7c6e7dbf41e04a0dc8c97b37e7fdee197916de1b277f43e155ca70a253349165f68ecaa3f3136f361b5fec7d5bf02ba261873441294f6b2cd388dabbe647354cda436fe61e6f3238c41b75ade95822d31ade6c48067fc15a8084f00b8e95014a716f59f80164391d980779825b1574f69e2af3acd34bb0da06e186e81cc2beaa476dcedee192dea8a78d10a20117a82e7a84837b9c03b648cf068a0981d4a6a1a1cbe12ed935c4c65e52f02615ab6f8fd0034c41eea150110b407c49abfe218df95981db35153bdc43d3210d8a1cb5af20ecad2300a38c0b1525cb6b26637c54d85c1fe3da5f6fa99037825fcea6ccecbce9b6b36e0864b8651e8fd6333362fd090e1fc5652c4b7537b5e74331e8d680ec9db403202c89f104a0e8c495f485d8860fb9bb5048dbc3dbec2aafb03f5fc34772c2d63684c65bb3a7aef7d2999bee7f41edf8a3f7b6cd5da00000d629cd28335250e0c65de4a132185494a1930d7fbe9afb9f7a826081a904a3a3862d0b49b79aab711d422ee07a6b0a769f3e1731b9a779ad32d72fe59c92f61fb5b22f543bbe77f769d9cf985f51931710cbfbd38a77050e7035479b7df5cd35984848b54eeb0cad9faea1135bdbe894197496c4331be8e546ad7f5b4f4bda6d1d07a0b781004b732e23f3b813c09a9a249ac25dfe57c693359fbea618bfcff9e22cf9619d6a2781bea4b57ae3d9666d82b4555ee9dd83c2c97d6b6b3441dd7ffd92413e074a54555f10c3f3e06dbc1c1fb8c8e9f688afdb09e85414f923d87d4d2de9dab8804736e649c2a577757e2c18c528269761fd8cd60749a0c6e3f11c84f5259284a9303a5621f8b609ea08bd39d7cf71d088cc66971ba2d3cd1cdaa6889ab0308f87718b8035cea05fc45c534c6e3b6ca264a0e1ab5cd6cafeb5ba53ceaf7d7b6419372f157d5f6c1c425ad73adc8dc5499c4b0132d0c926066f55e5bfa89f8f841dde3d98157c5f9f5670bcefaa6bad593074f3d173b444d665021ded00065bf8eaa846bbdad6b3343456408da3a85e3f84df4bf2d850d4b4cde068dc39299171877cb91ba8c518c3077f2940e61a3c95206f391e91bc7bc519b12a19cf03812b47c5d09bacc8eb839ef01a0b618da150eaaefc49c16aef48ec0b8daa69ad7b2f215b097d666cdf2e6452c28f8c1abc2630d2867df6884ceccffe8081063588e593daea6141702f61cd16ee0d43df66dad3c76de40452c394236b10af4ce227865d9335c7055925b333336574b1399b4ba15101f307f9676a6c5c0c0d80dc84ce7e0fcb9e3966b9ef376a45dcda438aa862e853527dd612b502d916ad2595acf8b5cc508c2a04987e7c0b69caa9720f279854345001a2656283e4fcac1b306e0fc4af60733b5b9f028c3ccea3d81c5c2bf1d4d35a83f02e6c5f70522fab84107234261db385c6a7d2f3b60596ecb5c87bf8d44387c3309a1047f593691042d281fc2f9fef69d35f12b1b781374d4b231d2fbf04c130fc462370818a45c6d0a0caefa730803db6b7d13a875d8ba4652a0c1be0d07fb8be45e9c2374c9de8b18fdb2736f5134fff56602410fe5586495a1a09ba83c3d65dfc8851b7e9ca250ebfabf59052c8cd73d2a5af10f676c9ab71b846bcb671c766ae1dccd613f708a7491777d0f794df7b471aabbdd6e4b3d5cd897d407a90e685c5188ec1f96e7dc6eca7c4ac56223d9a1534efb7833fc2e57682a99530c3c3001f7ffb4dfbc18c91ba903002602fb6ba07b67d99ab1a83ba6628edf666eaafadf0aeebd285b3bc6390cd0115249b5523088e08456f37a263e18ca874b4f185bc5705b2d8126cb960d9aacac0bc9ca275e3dd1c1f7f2db175c30aa5ca1e2f045f301c9a739ce6d02e0061e64d16c2af8271639dfe6f6b0db4d7bcbeb997d4a78b1dab0f7f00057f76a1e6ac90533a61a0661e1acf9e7f9abfff5d1cc14d7ac35d6d9de0ff76681ae3c80ce6cd0a7a1b3c8319e68dd9e9d60211f6193ee6f45ae589ec8f8152ff7db95925d3b5a878c28cc9ad53b58af5888c0bfb871a984ebf49caf79aff48f7a6b8a54ca317a4331bfdafc790a7048a0034059a8ad606d569382f5c5add0914090297e4f0a9b18560d8e1d06be5fc7a2f34b9b93c5ab84e1512b2d1d7bf4aad1aa89bad79017efbafcd4322068e2401d94866d028a1909813dfe73e8eb98b7ff95425b9ef4e07d8f94e17bfc23d82e1008d560f59d0a342870e8231d167dd0aa0f7cdd264b807fbd41c3fcbca548f94bd8edf3c537af6a71dd39481875623d2a48c351cd987699dcaf28138955a39cb1cbec51667c8d1321c3c91a96278eadf3911f0f72e0a2fef148b43a9c84f31c2deae1c3a34d43bae701e73250216d22a902609f1ce2c96a4ec09943bf54d27db4cf87f347c71822037ad2f4dc4e421dc4ba7bb4fb2ce18d93d0a4d317353bfa9fbcea42e67330e1a51284bde42313ef9d4a5aeb95d8249dacd86707b8ee05699c4d1e76546a483079142444fe5670fc763f71445765d45bb65107d3cb19dfd2a3a3a019d70c7ecff8749d0849dc045cd2ed011f29c9acdf435a628fae46ff96cfce6abacde8decd7b49dfd57c6ed873bd52a726808e6c599ce4cd7b7c9408021515c5eb3ea1d1036492ed8c7b6a73ffc8996a760a78cf3c1fa0efd7d6689d5a70933eff67847b58b8dc19fb3aba75f568e4412ded64b6923b83095e49cd87cc2ff3c5d692fecd67343af60e8ff989febb375982e3c538cb9ad8c76e2e8b13e5e8cf82900536c7cafbaa947f77d8355edc35574f61bf7b9d1614f9710e12c85ae543ed4e894596ed3bf9109fdedb1546ae5dedc186ad9f7769b93184a0a6d70289afb9d8a202b75dc4db8e05f551bbf211b8625ffbcbf23983de93c03c517760eb2c4e98f533f92c8b1551d44e5a947ecab1f12680c4b4234735627fdd16b2b37eb7259fb1bf9541f4849eb4569217c42e6627aaf5695e17e2f39d6d84d6801d84ad20b3447155e8ab6b2eceb080711eed6eaa94a447fa100b4f2e5ccb9cd7d4ad2f00466b7a9c24740ffd84b31c822da15df0c2e292e66385cd702d2348aaab8a57796bad0f9abb2e22b598522b4e5d6f1e712692880da9cd9d466823ac89f9f3dd72bfbe997ffb783ed48273982045ce9e80e6de9135b80ce22300f29a1361709b0b5c37ca8f7faea7e5be6498a6b72003d152593e53a5641f17fad6a5e52ffdee7f2a7731e1d9837ad0fcd48fa5a4007a15f2377d490cbde32dc524c83e812545dc03f6f26d40fe379ad71ab9c23ba8d53e58fdf8d7de5ff68c03884f31f411a6fda25707fcb79254d254e4803d2d9cc71f4f166455a61dbf62edce134cc2431481fdfee0177800e3bbe168ab0468dc5d84bd89c4401ec14cf5d94ea281e2cb5b50a75179f251172178147b64d9c20081a79beef5f120117130e09a2632027eeadc39510b1787ad5bccdfc62057576ff719f82b16066ccf9f91f857c138c5dc0224f029658b638affb20de81ed1d25c35c8003aa4673d113c1216e30037e0208374e4aef6489702717810497defab53db0a2ac8636e71b07a598e37408c213223bda8ff86a26a0db03b925459ba16779c484b71a2156c1d1427c01d30086e1acb708eea9263676a1341ad1776c34f216ac3952822600eb0c0f4a99faaa9a1799889a2928eab6d20e676d509bf913ec253ae21469321daaae4f8a335f0fd090240534a731b06f95283175a52e21bc4b70b25b0354f8176995543c029e02e30974bd4a077fe42fa7998628213339a9fd0b39ef60310493033b5d0960d2f0171d29e0f6301dd01c83a49e328f8bcd27ee01f7ca6fcd726fa3d4981d80ce50551ec4acd928dc46eede274ec9bfb53fb075ee81434c83ee9f707aa9058288fbf5564879f1e9be0e47ec97d6f8b486753288caede64b176d6fedee460a5dd2fc0d41ae38d7248efb8a4685b9b010b8c0e8bf9a09f2c7b2b771c781e7d698c6d6dbe854d62089be72f45c23a036226a8e602914045503bfcc56c6a7600000000";
#endif
    size_t len = strlen(TXSTR);
    uint8_t *tx = (uint8_t *)malloc(len / 2);
    misc_str2bin(tx, len/2, TXSTR);

    const uint8_t byte = 0;
    uint8_t h256[BTC_SZ_HASH256];
    mbedtls_sha256(&byte, 1, h256, 0);
    mbedtls_sha256(h256, sizeof(h256), h256, 0);
    for (int lp = 0; lp < BTC_SZ_HASH256; lp++) {
        printf("%02x", h256[lp]);
    }
    printf("\n");
    btc_tx_print_raw(tx, len/2);

    uint32_t vsize = btc_tx_get_vbyte_raw(tx, len/2);
    printf("vsize=%" PRIu32 "\n", vsize);

    free(tx);
#endif

    printf("=======================================\n");

    btc_term();

    return 0;
}
